<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-12-06T09:08:37.095475477"><title>Working with tables | Exposed</title><script type="application/json" id="virtual-toc-data">[{"id":"table-types","level":0,"title":"Table Types","anchor":"#table-types"},{"id":"table-class","level":1,"title":"Table","anchor":"#table-class"},{"id":"id-table-type","level":1,"title":"IdTable","anchor":"#id-table-type"},{"id":"defining-tables","level":0,"title":"Defining tables","anchor":"#defining-tables"},{"id":"name-from-object","level":1,"title":"Configuring a custom table name","anchor":"#name-from-object"},{"id":"constraints","level":0,"title":"Constraints","anchor":"#constraints"},{"id":"nullable","level":1,"title":"Nullable","anchor":"#nullable"},{"id":"default","level":1,"title":"Default","anchor":"#default"},{"id":"index","level":1,"title":"Index","anchor":"#index"},{"id":"unique","level":1,"title":"Unique","anchor":"#unique"},{"id":"primary-key","level":1,"title":"Primary Key","anchor":"#primary-key"},{"id":"foreign-key","level":1,"title":"Foreign Key","anchor":"#foreign-key"},{"id":"check","level":1,"title":"Check","anchor":"#check"},{"id":"dsl-create-table","level":0,"title":"Creating tables","anchor":"#dsl-create-table"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/exposed-logo.svg"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Working with tables | Exposed"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Exposed Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/docs/0.57.0/working-with-tables.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Working with tables | Exposed"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/docs/0.57.0/working-with-tables.html#webpage",
    "url": "writerside-documentation/docs/0.57.0/working-with-tables.html",
    "name": "Working with tables | Exposed",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/docs/#website",
    "url": "writerside-documentation/docs/",
    "name": "Exposed Help"
}</script><!-- End Schema.org --></head><body data-id="Working-with-Tables" data-main-title="Working with tables" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Schemas"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Exposed 0.57.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Working-with-Tables" id="Working-with-Tables.topic">Working with tables</h1><p id="l6rdrw_4">In this topic, we will explain how to define, configure, and create tables. All examples use the H2 database to generate SQL.</p><section class="chapter"><h2 id="table-types" data-toc="table-types">Table Types</h2><section class="chapter"><h3 id="table-class" data-toc="table-class">Table</h3><p> In Exposed, the <a href="https://jetbrains.github.io/Exposed/api/exposed-core/org.jetbrains.exposed.sql/-table/index.html" id="l6rdrw_242" data-external="true" rel="noopener noreferrer"><code class="code" id="l6rdrw_243">Table</code></a> class is the core abstraction for defining database tables. This class provides methods to define various <a href="data-types.html" id="l6rdrw_244" data-tooltip="Exposed supports the following data types in the table definition:">column types</a>, <a href="#constraints" id="l6rdrw_245" data-tooltip="The NOT NULL SQL constraint restricts the column to accept the null value. By default, Exposed applies this constraint to all the columns. To allow the column to be nullable, apply the nullable() method to a definition of an appropriate column.">constraints</a>, and other table-specific properties. </p><p id="l6rdrw_246"><code class="code" id="l6rdrw_247">Table</code> is located in the <span class="control" id="l6rdrw_248">org.jetbrains.exposed.sql</span> package of the <span class="control" id="l6rdrw_249">exposed-core</span> module.</p></section><section class="chapter"><h3 id="id-table-type" data-toc="id-table-type">IdTable</h3><p id="l6rdrw_250">Apart from the core <code class="code" id="l6rdrw_251">Table</code> class, Exposed provides the base <code class="code" id="l6rdrw_252">IdTable</code> class and its subclasses through the DAO API.</p><p id="l6rdrw_253">The <code class="code" id="l6rdrw_254">IdTable</code> class extends <code class="code" id="l6rdrw_255">Table</code> and is designed to simplify the definition of tables that use a standard <code class="code" id="l6rdrw_256">id</code> column as the primary key. These tables can be declared without explicitly including the <code class="code" id="l6rdrw_257">id</code> column, as IDs of the appropriate type are automatically generated when creating new table rows.</p><p id="l6rdrw_258"><code class="code" id="l6rdrw_259">IdTable</code> and its subclasses are located in the <span class="control" id="l6rdrw_260">org.jetbrains.exposed.dao.id</span> package of the <span class="control" id="l6rdrw_261">exposed-core</span> module.</p><p> For more information on <code class="code" id="l6rdrw_5">IdTable</code> types, see <a href="dao-table-types.html" id="l6rdrw_6" data-tooltip="Apart from the core Table class, Exposed provides the base IdTable class and its subclasses through the DAO API.">DAO Table Types</a>.</p></section></section><section class="chapter"><h2 id="defining-tables" data-toc="defining-tables">Defining tables</h2><p id="l6rdrw_7">A database table is represented by an object inherited from a table class.</p><div class="code-block" data-lang="kotlin">
            object StarWarsFilms : Table() {}
        </div><p id="l6rdrw_9">Exposed supports a variety of <a href="data-types.html" id="l6rdrw_10" data-tooltip="Exposed supports the following data types in the table definition:">column types</a>, including <code class="code" id="l6rdrw_11">integer</code>, <code class="code" id="l6rdrw_12">varchar</code>, <code class="code" id="l6rdrw_13">bool</code>, and more. Each column is defined by calling the appropriate method on the <code class="code" id="l6rdrw_14">Table</code> object.</p><p id="l6rdrw_15">The following example defines a table with an auto-incrementing integer <code class="code" id="l6rdrw_16">id</code> column and custom columns <code class="code" id="l6rdrw_17">sequel_id</code>, <code class="code" id="l6rdrw_18">name</code>, and <code class="code" id="l6rdrw_19">director</code>:</p><div class="tabs" id="l6rdrw_20" data-group="type" data-anchors="[dao-table-def,dsl-table-def]"><div class="tabs__content" data-gtm="tab" id="dsl-table-def" data-sync-tabs="Table" data-title="Table"><div class="code-block" data-lang="kotlin" id="StarWarsFilmsTable-dsl-code-block" data-title="Kotlin" data-disable-link-processing="true">import org.jetbrains.exposed.sql.Table

const val MAX_VARCHAR_LENGTH = 50

object StarWarsFilmsTable : Table() {
    val id = integer(&quot;id&quot;).autoIncrement()
    val sequelId = integer(&quot;sequel_id&quot;).uniqueIndex()
    val name = varchar(&quot;name&quot;, MAX_VARCHAR_LENGTH)
    val director = varchar(&quot;director&quot;, MAX_VARCHAR_LENGTH)
}</div></div><div class="tabs__content" data-gtm="tab" id="dao-table-def" data-sync-tabs="IntIdTable" data-title="IntIdTable"><div class="code-block" data-lang="kotlin" id="StarWarsFilmsTable-dao-code-block" data-title="Kotlin" data-disable-link-processing="true">import org.jetbrains.exposed.dao.id.IntIdTable

const val MAX_VARCHAR_LENGTH = 50

object StarWarsFilmsTable : IntIdTable() {
    val sequelId = integer(&quot;sequel_id&quot;).uniqueIndex()
    val name = varchar(&quot;name&quot;, MAX_VARCHAR_LENGTH)
    val director = varchar(&quot;director&quot;, MAX_VARCHAR_LENGTH)
}</div></div></div><p id="l6rdrw_23"> The <code class="code" id="l6rdrw_262">IntIdTable</code> class automatically generates an auto-incrementing integer <code class="code" id="l6rdrw_263">id</code> column, which serves as the primary key for the table.  Therefore, there is no need to explicitly define the <code class="code" id="l6rdrw_25">id</code> column in the <code class="code" id="l6rdrw_26">StarWarsFilmsTable</code> object.</p><p id="l6rdrw_27">Creating the table with the above definition will result in the following SQL equivalent:</p><div class="tabs" id="l6rdrw_28" data-group="type" data-anchors="[dao-create-table-sql,dsl-create-table-sql]"><div class="tabs__content" data-gtm="tab" id="dsl-create-table-sql" data-sync-tabs="Table" data-title="Table"><div class="code-block" data-lang="sql" id="StarWarsFilmsTable-dsl-sql" data-title="SQL" data-disable-link-processing="true">     CREATE TABLE IF NOT EXISTS STARWARSFILMS
     (ID INT AUTO_INCREMENT NOT NULL,
      SEQUEL_ID INT NOT NULL,
      &quot;name&quot; VARCHAR(50) NOT NULL,
      DIRECTOR VARCHAR(50) NOT NULL)</div></div><div class="tabs__content" data-gtm="tab" id="dao-create-table-sql" data-sync-tabs="IntIdTable" data-title="IntIdTable"><div class="code-block" data-lang="sql" id="StarWarsFilmsTable-dao-sql" data-title="SQL" data-disable-link-processing="true">    CREATE TABLE IF NOT EXISTS STARWARSFILMS
    (ID INT AUTO_INCREMENT PRIMARY KEY,
    SEQUEL_ID INT NOT NULL,
    &quot;name&quot; VARCHAR(50) NOT NULL,
    DIRECTOR VARCHAR(50) NOT NULL);</div></div></div><section class="chapter"><h3 id="name-from-object" data-toc="name-from-object">Configuring a custom table name</h3><p id="l6rdrw_31">By default, Exposed generates the table name from the full class name.</p><p id="l6rdrw_32">If the object name contains a 'Table' suffix, Exposed will omit the suffix from the generated table name:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">object StarWarsFilmsTable : Table() {
    val id = integer(&quot;id&quot;).autoIncrement()
    val sequelId = integer(&quot;sequel_id&quot;).uniqueIndex()
    val name = varchar(&quot;name&quot;, MAX_VARCHAR_LENGTH)
    val director = varchar(&quot;director&quot;, MAX_VARCHAR_LENGTH)
}
</div><div class="code-block" data-lang="sql" data-disable-link-processing="true">     CREATE TABLE IF NOT EXISTS STARWARSFILMS
     (ID INT AUTO_INCREMENT NOT NULL,
      SEQUEL_ID INT NOT NULL,
      &quot;name&quot; VARCHAR(50) NOT NULL,
      DIRECTOR VARCHAR(50) NOT NULL)</div><p id="l6rdrw_35">To configure a custom name for a table, which will be used in actual SQL queries, pass it to the <code class="code" id="l6rdrw_36">name</code> parameter of the <code class="code" id="l6rdrw_37">Table()</code> constructor.</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">object CustomStarWarsFilmsTable : Table(&quot;all_star_wars_films&quot;) {
    val id = integer(&quot;id&quot;).autoIncrement()
    val sequelId = integer(&quot;sequel_id&quot;).uniqueIndex()
    val name = varchar(&quot;name&quot;, MAX_VARCHAR_LENGTH)
    val director = varchar(&quot;director&quot;, MAX_VARCHAR_LENGTH)
}
</div><div class="code-block" data-lang="sql" data-disable-link-processing="true">    CREATE TABLE IF NOT EXISTS ALL_STAR_WARS_FILMS
    (ID INT AUTO_INCREMENT NOT NULL,
    SEQUEL_ID INT NOT NULL,
    &quot;name&quot; VARCHAR(50) NOT NULL,
    DIRECTOR VARCHAR(50) NOT NULL)</div><p id="l6rdrw_40">Some databases, like H2, fold unquoted identifiers to upper case. To keep table name case-sensitivity, manually quote the provided argument:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">object StarWarsFilms : Table(&quot;\&quot;all_star_wars_films\&quot;&quot;) {
    val id = integer(&quot;id&quot;).autoIncrement()
    val sequelId = integer(&quot;sequel_id&quot;).uniqueIndex()
    val name = varchar(&quot;name&quot;, MAX_VARCHAR_LENGTH)
    val director = varchar(&quot;director&quot;, MAX_VARCHAR_LENGTH)
}
</div><div class="code-block" data-lang="sql" data-disable-link-processing="true">    CREATE TABLE IF NOT EXISTS &quot;all_star_wars_films&quot;
    (ID INT AUTO_INCREMENT NOT NULL,
    SEQUEL_ID INT NOT NULL,
    &quot;name&quot; VARCHAR(50) NOT NULL,
    DIRECTOR VARCHAR(50) NOT NULL)</div><p id="l6rdrw_43">Depending on what DBMS you use, the types of columns could be different in actual SQL queries.</p></section></section><section class="chapter"><h2 id="constraints" data-toc="constraints">Constraints</h2><section class="chapter"><h3 id="nullable" data-toc="nullable">Nullable</h3><p id="l6rdrw_44">The <code class="code" id="l6rdrw_45">NOT NULL</code> SQL constraint restricts the column to accept the <code class="code" id="l6rdrw_46">null</code> value. By default, Exposed applies this constraint to all the columns. To allow the column to be nullable, apply the <code class="code" id="l6rdrw_47">nullable()</code> method to a definition of an appropriate column.</p><p id="l6rdrw_48">For example, to make the population column <code class="code" id="l6rdrw_49">nullable</code>, use the following code:</p><div class="code-block" data-lang="kotlin">
                // SQL: POPULATION INT NULL
                val population: Column&lt;Int?&gt; = integer(&quot;population&quot;).nullable()
            </div></section><section class="chapter"><h3 id="default" data-toc="default">Default</h3><p id="l6rdrw_51">The <code class="code" id="l6rdrw_52">DEFAULT</code> SQL constraint provides the default value for the column. Exposed supports three methods for configuring default values:</p><ul class="list _bullet" id="l6rdrw_53"><li class="list__item" id="l6rdrw_54"><p><code class="code" id="l6rdrw_55">default(defaultValue: T)</code> accepts a value with a type of the column.</p></li><li class="list__item" id="l6rdrw_56"><p><code class="code" id="l6rdrw_57">defaultExpression(defaultValue: Expression&lt;T&gt;)</code> accepts an expression.</p></li><li class="list__item" id="l6rdrw_58"><p><code class="code" id="l6rdrw_59">clientDefault(defaultValue: () -&gt; T)</code> accepts a function.</p></li></ul><p id="l6rdrw_60">For example, to configure the default value for the <code class="code" id="l6rdrw_61">name</code> column, use the following code:</p><div class="code-block" data-lang="kotlin">
                // SQL: &quot;NAME&quot; VARCHAR(50) DEFAULT 'Unknown'
                val name: Column&lt;String&gt; = varchar(&quot;name&quot;, 50).default(&quot;Unknown&quot;)
            </div><p id="l6rdrw_63">Exposed also supports marking a column as <code class="code" id="l6rdrw_64">databaseGenerated</code> if the default value of the column is not known at the time of table creation and/or if it depends on other columns. It makes it possible to omit setting a value for the column when inserting a new record, without getting an error. The value for the column can be set by creating a TRIGGER or with a DEFAULT clause, for example.</p><p id="l6rdrw_65">For example:</p><div class="code-block" data-lang="kotlin">
                val name: Column&lt;String&gt; = varchar(&quot;name&quot;, 50).databaseGenerated()
            </div></section><section class="chapter"><h3 id="index" data-toc="index">Index</h3><p id="l6rdrw_67">The <code class="code" id="l6rdrw_68">INDEX</code> SQL constraint makes traversing through tables quicker. Exposed supports the <code class="code" id="l6rdrw_69">index()</code> method. It has six parameters, most of which are optional:</p><ul class="list _bullet" id="l6rdrw_70"><li class="list__item" id="l6rdrw_71"><p><code class="code" id="l6rdrw_72">val customIndexName: String? = null</code> is a custom name for the index, which will be used in actual SQL queries.</p></li><li class="list__item" id="l6rdrw_73"><p><code class="code" id="l6rdrw_74">val unique: Boolean</code> defines whether the index is unique or not.</p></li><li class="list__item" id="l6rdrw_75"><p><code class="code" id="l6rdrw_76">val columns: List&lt;Column&lt;*&gt;&gt;</code> defines a column set.</p></li><li class="list__item" id="l6rdrw_77"><p><code class="code" id="l6rdrw_78">val functions: List&lt;ExpressionWithColumnType&lt;*&gt;&gt;? = null</code> defines functional key parts.</p></li><li class="list__item" id="l6rdrw_79"><p><code class="code" id="l6rdrw_80">val indexType: String? = null</code> is a custom type. Can be <code class="code" id="l6rdrw_81">&quot;BTREE&quot;</code> or <code class="code" id="l6rdrw_82">&quot;HASH&quot;</code>.</p></li><li class="list__item" id="l6rdrw_83"><p><code class="code" id="l6rdrw_84">val filterCondition: (SqlExpressionBuilder.() -&gt; Op&lt;Boolean&gt;)? = null</code> defines a condition used to create a partial index.</p></li></ul><p id="l6rdrw_85">The simplest way to create an index is to use an extension function directly on a column. For example, to apply a non-unique <code class="code" id="l6rdrw_86">INDEX</code> constraint to the <code class="code" id="l6rdrw_87">name</code> column, use the following code:</p><div class="code-block" data-lang="kotlin">
                val name = varchar(&quot;name&quot;, 50).index()
            </div><p id="l6rdrw_89">If the parameter <code class="code" id="l6rdrw_90">customIndexName</code> is not set, the name of the index is determined by the table and column names.</p><p id="l6rdrw_91">Also, Exposed supports complex indexes. If you have a frequent query for two columns, Exposed can perform it more efficiently. It creates a tree from the first column with the references to the second one. For example, to create a non-unique complex index on the <code class="code" id="l6rdrw_92">name</code> and <code class="code" id="l6rdrw_93">population</code> columns, paste the following code:</p><div class="code-block" data-lang="kotlin">
                val indexName = index(&quot;indexName&quot;, false, *arrayOf(name, population))
                // or inside an init block within the table object
                init {
                    index(&quot;indexName&quot;, isUnique = false, name, population)
                }
            </div><p id="l6rdrw_95">Exposed also supports creating an index with a custom type. For example, to retrieve data from the <code class="code" id="l6rdrw_96">name</code> column faster with a hash function for traversing, use the following code:</p><div class="code-block" data-lang="kotlin">
                val indexName = index(&quot;indexName&quot;, false, *arrayOf(name), indexType = &quot;HASH&quot;)
            </div><p id="l6rdrw_98">Some databases support functional key parts that index expressions instead of columns directly:</p><div class="code-block" data-lang="kotlin">
                init {
                    index(functions = listOf(name.lowerCase(), address.substring(1, 5)))
                    uniqueIndex(
                        columns = arrayOf(name),
                        functions = listOf(Coalesce(address, stringLiteral(&quot;*&quot;)))
                    )
                }
            </div><p id="l6rdrw_100">Operator expressions, like <code class="code" id="l6rdrw_101">plus()</code>, are also accepted by the <code class="code" id="l6rdrw_102">functions</code> parameter.</p><p id="l6rdrw_103">Some databases support creating a partial index by defining a filter expression to improve querying performance. The created index will only contain entries for the table rows that match this predicate:</p><div class="code-block" data-lang="kotlin">
                init {
                    index(columns = arrayOf(name, flag)) { flag eq true }
                    index(
                        columns = arrayOf(
                            name,
                            population
                        )
                    ) { (name like &quot;A%&quot;) and (population greaterEq 10) }
                }
            </div><p id="l6rdrw_105">Once a table has been created, the list of its indices can be accessed using the property <code class="code" id="l6rdrw_106">Table.indices</code>. Table indices are represented by the data class <code class="code" id="l6rdrw_107">Index</code>, so its properties can be checked in the following manner, for example:</p><div class="code-block" data-lang="kotlin">
                Table.indices.map { it.indexName to it.createStatement().first() }
            </div><aside class="prompt" data-type="note" data-title="" id="l6rdrw_109"><p>An instance of the <code class="code" id="l6rdrw_110">Index</code> data class can be created directly using its public constructor, for the purpose of evaluating or using create/modify/drop statements, for example. Doing so will not add the instance to an existing table's list of indices in the way that using <code class="code" id="l6rdrw_111">index()</code> would. Also, if an instance is created with arguments provided to the <code class="code" id="l6rdrw_112">functions</code> parameter, a <code class="code" id="l6rdrw_113">functionsTable</code> argument must also be provided.</p></aside></section><section class="chapter"><h3 id="unique" data-toc="unique">Unique</h3><p id="l6rdrw_114">The <code class="code" id="l6rdrw_115">UNIQUE</code> SQL constraint restricts duplicates within this column. Exposed supports the <code class="code" id="l6rdrw_116">uniqueIndex()</code> method which creates a unique index for the column. This method is the composition of <code class="code" id="l6rdrw_117">UNIQUE</code> and <code class="code" id="l6rdrw_118">INDEX</code> constraint, the quicker modification of <code class="code" id="l6rdrw_119">UNIQUE</code> constraint.</p><p id="l6rdrw_120">For example, to apply <code class="code" id="l6rdrw_121">UNIQUE</code> and <code class="code" id="l6rdrw_122">INDEX</code> constraint to the <code class="code" id="l6rdrw_123">name</code> column, use the following code:</p><div class="code-block" data-lang="kotlin">
                val name = varchar(&quot;name&quot;, 50).uniqueIndex()
            </div></section><section class="chapter"><h3 id="primary-key" data-toc="primary-key">Primary Key</h3><p id="l6rdrw_125">The <code class="code" id="l6rdrw_126">PRIMARY KEY</code> SQL constraint applied to a column means each value in that column identifies the row. This constraint is the composition of <code class="code" id="l6rdrw_127">NOT NULL</code> and <code class="code" id="l6rdrw_128">UNIQUE</code> constraints. To change the column set, add columns, or change the primary key name to a custom one, override this field of the table class.</p><p id="l6rdrw_129">For example, to define the <code class="code" id="l6rdrw_130">name</code> column as the primary key, use the following code. The &quot;Cities_name&quot; string will be used as the constraint name in the actual SQL query, if provided; otherwise a name will be generated based on the table's name.</p><div class="code-block" data-lang="kotlin">
                override val primaryKey = PrimaryKey(name, name = &quot;Cities_name&quot;)
            </div><div class="code-block" data-lang="sql">
                CONSTRAINT Cities_name PRIMARY KEY (&quot;name&quot;)
            </div><p id="l6rdrw_133">It is also possible to define a primary key on a table using multiple columns:</p><div class="code-block" data-lang="kotlin">
                override val primaryKey = PrimaryKey(id, name)
            </div><div class="code-block" data-lang="sql">
                CONSTRAINT pk_Cities PRIMARY KEY (ID, &quot;name&quot;)
            </div><p id="l6rdrw_136">Except for <code class="code" id="l6rdrw_137">CompositeIdTable</code>, each available class in Exposed that inherits from <code class="code" id="l6rdrw_138">IdTable</code> has the <code class="code" id="l6rdrw_139">primaryKey</code> field automatically defined. For example, the <code class="code" id="l6rdrw_140">IntIdTable</code> by default has an auto-incrementing integer column, <code class="code" id="l6rdrw_141">id</code>, which is defined as the primary key.</p><p id="l6rdrw_142">An <code class="code" id="l6rdrw_143">IdTable</code> that requires a primary key with multiple columns can be defined using <code class="code" id="l6rdrw_144">CompositeIdTable</code>. In this case, each column that is a component of the table's <code class="code" id="l6rdrw_145">id</code> should be identified by <code class="code" id="l6rdrw_146">entityId()</code>:</p><div class="code-block" data-lang="kotlin">
                object Towns : CompositeIdTable(&quot;towns&quot;) {
                    val areaCode = integer(&quot;area_code&quot;).autoIncrement().entityId()
                    val latitude = decimal(&quot;latitude&quot;, 9, 6).entityId()
                    val longitude = decimal(&quot;longitude&quot;, 9, 6).entityId()
                    val name = varchar(&quot;name&quot;, 32)

                    override val primaryKey = PrimaryKey(areaCode, latitude, longitude)
                }
            </div><p id="add-id-column-tip">If any of the key component columns have already been marked by <code class="code" id="l6rdrw_148">entityId()</code> in another table, they can still be identified using <code class="code" id="l6rdrw_149">addIdColumn()</code>. This might be useful for key columns that reference another <code class="code" id="l6rdrw_150">IdTable</code>:</p><div class="code-block" data-lang="kotlin">
                object AreaCodes : IdTable&lt;Int&gt;(&quot;area_codes&quot;) {
                    override val id = integer(&quot;code&quot;).entityId()
                    override val primaryKey = PrimaryKey(id)
                }

                object Towns : CompositeIdTable(&quot;towns&quot;) {
                    val areaCode = reference(&quot;area_code&quot;, AreaCodes)
                    val latitude = decimal(&quot;latitude&quot;, 9, 6).entityId()
                    val longitude = decimal(&quot;longitude&quot;, 9, 6).entityId()
                    val name = varchar(&quot;name&quot;, 32)

                    init {
                        addIdColumn(areaCode)
                    }

                    override val primaryKey = PrimaryKey(areaCode, latitude, longitude)
                }
            </div><aside class="prompt" data-type="tip" data-title="" id="l6rdrw_152"><p>For more information on <code class="code" id="l6rdrw_153">CompositeIdTable</code> types, see <a href="dao-table-types.html" id="l6rdrw_154" data-tooltip="Apart from the core Table class, Exposed provides the base IdTable class and its subclasses through the DAO API.">DAO Table Types</a>.</p></aside></section><section class="chapter"><h3 id="foreign-key" data-toc="foreign-key">Foreign Key</h3><p id="l6rdrw_155">The <code class="code" id="l6rdrw_156">FOREIGN KEY</code> SQL constraint links two tables. A foreign key is a column from one table that refers to the primary key or columns with a unique index from another table. To configure a foreign key on a column, use <code class="code" id="l6rdrw_157">reference()</code> or <code class="code" id="l6rdrw_158">optReference()</code> methods. The latter lets the foreign key accept a <code class="code" id="l6rdrw_159">null</code> value. To configure a foreign key on multiple columns, use <code class="code" id="l6rdrw_160">foreignKey()</code> directly within an <code class="code" id="l6rdrw_161">init</code> block.</p><p id="l6rdrw_162"><code class="code" id="l6rdrw_163">reference()</code> and <code class="code" id="l6rdrw_164">optReference()</code> methods have several parameters:</p><dl id="l6rdrw_165" data-style="title-top"><dt id="name" data-expandable="false"><code class="code" id="l6rdrw_167">name: String</code></dt><dd><p id="l6rdrw_168">A name for the foreign key column, which will be used in actual SQL queries.</p></dd><dt id="ref" data-expandable="false"><code class="code" id="l6rdrw_170">ref: Column&lt;T&gt;</code></dt><dd><p id="l6rdrw_171">A target column from another parent table.</p></dd><dt id="onDelete" data-expandable="false"><code class="code" id="l6rdrw_173">onDelete: ReferenceOption? = null</code></dt><dd><p id="l6rdrw_174">An action for when a linked row from a parent table will be deleted.</p></dd><dt id="onUpdate" data-expandable="false"><code class="code" id="l6rdrw_176">onUpdate: ReferenceOption? = null</code></dt><dd><p id="l6rdrw_177">An action for when a value in a referenced column will be changed.</p></dd><dt id="fkName" data-expandable="false"><code class="code" id="l6rdrw_179">fkName: String? = null</code></dt><dd><p id="l6rdrw_180">A name for the foreign key constraint.</p></dd></dl><p id="l6rdrw_181">Enum class <code class="code" id="l6rdrw_182">ReferenceOption</code> has five values:</p><dl id="l6rdrw_183" data-style="title-top"><dt id="l6rdrw_184" data-expandable="false"><code class="code" id="l6rdrw_186">RESTRICT</code></dt><dd><p id="l6rdrw_187">An option that restricts changes on a referenced column, and the default option for most dialects.</p></dd><dt id="l6rdrw_188" data-expandable="false"><code class="code" id="l6rdrw_190">NO_ACTION</code></dt><dd><p id="l6rdrw_191">The same as RESTRICT in some, but not all, databases, and the default option for Oracle and SQL Server dialects.</p></dd><dt id="l6rdrw_192" data-expandable="false"><code class="code" id="l6rdrw_194">CASCADE</code></dt><dd><p id="l6rdrw_195">An option that allows updating or deleting the referring rows.</p></dd><dt id="l6rdrw_196" data-expandable="false"><code class="code" id="l6rdrw_198">SET_NULL</code></dt><dd><p id="l6rdrw_199">An option that sets the referring column values to null.</p></dd><dt id="l6rdrw_200" data-expandable="false"><code class="code" id="l6rdrw_202">SET_DEFAULT</code></dt><dd><p id="l6rdrw_203">An option that sets the referring column values to the default value.</p></dd></dl><p id="l6rdrw_204">Consider the following <code class="code" id="l6rdrw_205">Citizens</code> table. This table has the <code class="code" id="l6rdrw_206">name</code> and <code class="code" id="l6rdrw_207">city</code> columns. If the <code class="code" id="l6rdrw_208">Cities</code> table has configured the <code class="code" id="l6rdrw_209">name</code> column as the primary key, the <code class="code" id="l6rdrw_210">Citizens</code> table can refer to it by its <code class="code" id="l6rdrw_211">city</code> column, which is a foreign key. To configure such reference and make it nullable, use the <code class="code" id="l6rdrw_212">optReference()</code> method:</p><div class="code-block" data-lang="kotlin">
                object Citizens : IntIdTable() {
                    val name = varchar(&quot;name&quot;, 50)
                    val city = optReference(&quot;city&quot;, Cities.name, onDelete = ReferenceOption.CASCADE)
                }
            </div><p id="l6rdrw_214">If any <code class="code" id="l6rdrw_215">Cities</code> row will be deleted, the appropriate <code class="code" id="l6rdrw_216">Citizens</code> row will be deleted too.</p><p id="l6rdrw_217">If instead the <code class="code" id="l6rdrw_218">Cities</code> table has configured multiple columns as the primary key (for example, both <code class="code" id="l6rdrw_219">id</code> and <code class="code" id="l6rdrw_220">name</code> columns as in the above <a href="#primary-key" id="l6rdrw_221" data-tooltip="The PRIMARY KEY SQL constraint applied to a column means each value in that column identifies the row. This constraint is the composition of NOT NULL and UNIQUE constraints. To change the column set, add columns, or change the primary key name to a custom one, override this field ofâ€¦">section</a>), the <code class="code" id="l6rdrw_222">Citizens</code> table can refer to it by using a table-level foreign key constraint. In this case, the <code class="code" id="l6rdrw_223">Citizens</code> table must have defined matching columns to store each component value of the <code class="code" id="l6rdrw_224">Cities</code> table's primary key:</p><div class="code-block" data-lang="kotlin">
                object Citizens : IntIdTable() {
                    val name = varchar(&quot;name&quot;, 50)
                    val cityId = integer(&quot;city_id&quot;)
                    val cityName = varchar(&quot;city_name&quot;, 50)

                    init {
                        foreignKey(cityId, cityName, target = Cities.primaryKey)
                    }
                }
            </div><p id="l6rdrw_226">In the above example, the order of the referencing columns in <code class="code" id="l6rdrw_227">foreignKey()</code> must match the order of columns defined in the target primary key. If this order is uncertain, the foreign key can be defined with explicit column associations instead:</p><div class="code-block" data-lang="kotlin">
                init {
                    foreignKey(cityId to Cities.id, cityName to Cities.name)
                }
            </div></section><section class="chapter"><h3 id="check" data-toc="check">Check</h3><p id="l6rdrw_229">The <code class="code" id="l6rdrw_230">CHECK</code> SQL constraint checks that all values in a column match some condition. Exposed supports the <code class="code" id="l6rdrw_231">check()</code> method. You apply this method to a column and pass the appropriate condition to it.</p><p id="l6rdrw_232">For example, to check that the <code class="code" id="l6rdrw_233">name</code> column contains strings that begin with a capital letter, use the following code:</p><div class="code-block" data-lang="kotlin">
                // SQL: CONSTRAINT check_Cities_0 CHECK (REGEXP_LIKE(&quot;NAME&quot;, '^[A-Z].*', 'c')))
                val name = varchar(&quot;name&quot;, 50).check { it regexp &quot;^[A-Z].*&quot; }
            </div><p id="l6rdrw_235">Some databases, like older MySQL versions, may not support <code class="code" id="l6rdrw_236">CHECK</code> constraints. For more information, consult the relevant documentation.</p></section></section><section class="chapter"><h2 id="dsl-create-table" data-toc="dsl-create-table">Creating tables</h2><p id="l6rdrw_237">To create a table within a database, you need to use the <code class="code" id="l6rdrw_238">SchemaUtils.create()</code> method within a <a href="transactions.html" id="l6rdrw_239" data-tooltip="CRUD operations in Exposed must be called from within a transaction. Transactions encapsulate a set of DSL operations. To create and execute a transaction with default parameters, simply pass a function block to the transaction function:">transaction</a>:</p><div class="code-block" data-lang="kotlin">
            transaction {
                SchemaUtils.create(StarWarsFilms)
                //...
            }
        </div><p id="l6rdrw_241">This will generate the SQL necessary to create the table based on your definition.</p></section><div class="last-modified">Last modified: 05 December 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="transactions.html" class="navigation-links__prev">Working with Transactions</a><a href="data-types.html" class="navigation-links__next">Data Types</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.js"></script></body></html>