<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-12-06T09:08:37.604861075"><title>Entity definition | Exposed</title><script type="application/json" id="virtual-toc-data">[{"id":"defining-entity-class","level":0,"title":"Defining an Entity class","anchor":"#defining-entity-class"},{"id":"entity-type","level":1,"title":"Entity type","anchor":"#entity-type"},{"id":"EntityClass","level":1,"title":"EntityClass","anchor":"#EntityClass"},{"id":"properties","level":1,"title":"Properties","anchor":"#properties"},{"id":"immutable-entities","level":0,"title":"Immutable entities","anchor":"#immutable-entities"},{"id":"class-method-overrides","level":0,"title":"Class method overrides","anchor":"#class-method-overrides"},{"id":"field-transformations","level":0,"title":"Field transformations","anchor":"#field-transformations"},{"id":"defining-unsigned-int-field","level":1,"title":"Example: Defining an Unsigned Integer field","anchor":"#defining-unsigned-int-field"},{"id":"memoized-transformations","level":1,"title":"Memoized transformations","anchor":"#memoized-transformations"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/exposed-logo.svg"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Entity definition | Exposed"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Exposed Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/docs/0.57.0/dao-entity-definition.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Entity definition | Exposed"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/docs/0.57.0/dao-entity-definition.html#webpage",
    "url": "writerside-documentation/docs/0.57.0/dao-entity-definition.html",
    "name": "Entity definition | Exposed",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/docs/#website",
    "url": "writerside-documentation/docs/",
    "name": "Exposed Help"
}</script><!-- End Schema.org --></head><body data-id="DAO-Entity-definition" data-main-title="Entity definition" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Deep Dive into DAO"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Exposed 0.57.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="DAO-Entity-definition" id="DAO-Entity-definition.topic">Entity definition</h1><p id="-60e45b_3">An <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-entity/index.html" id="-60e45b_4" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_5">Entity</code></a> in Exposed maps a database table record to a Kotlin object. This ensures type safety and allows you to work with database records just like regular Kotlin objects, taking full advantage of Kotlin's language features.</p><p id="-60e45b_6">When using the DAO approach, <code class="code" id="-60e45b_7">IdTable</code> needs to be associated with an <code class="code" id="-60e45b_8">Entity</code>, because every database record in this table needs to be mapped to an <code class="code" id="-60e45b_9">Entity</code> instance, identified by its primary key.</p><section class="chapter"><h2 id="defining-entity-class" data-toc="defining-entity-class">Defining an Entity class</h2><p id="-60e45b_10">You define an entity instance by creating a class. In the following example, <code class="code" id="-60e45b_11">StarWarsFilmEntity</code> is the entity class linked to the table <code class="code" id="-60e45b_12">StarWarsFilmsTable</code>:</p><div class="tabs" id="-60e45b_13" data-anchors="[macos-install,windows-install]"><div class="tabs__content" data-gtm="tab" id="windows-install" data-title="StarWarsFilmEntity"><div class="code-block" data-lang="kotlin" data-title="Kotlin" data-disable-link-processing="true">package org.example.entities

import org.example.tables.StarWarsFilmsTable
import org.jetbrains.exposed.dao.IntEntity
import org.jetbrains.exposed.dao.IntEntityClass
import org.jetbrains.exposed.dao.id.EntityID

class StarWarsFilmEntity(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    companion object : IntEntityClass&lt;StarWarsFilmEntity&gt;(StarWarsFilmsTable)

    var sequelId by StarWarsFilmsTable.sequelId
    var name by StarWarsFilmsTable.name
    var director by StarWarsFilmsTable.director
}
</div></div><div class="tabs__content" data-gtm="tab" id="macos-install" data-title="StarWarsFilmsTable"></div></div><section class="chapter"><h3 id="entity-type" data-toc="entity-type">Entity type</h3><p id="-60e45b_15">The entity type determines how the <code class="code" id="-60e45b_16">Entity</code> class interacts with the table&rsquo;s primary key. Since <code class="code" id="-60e45b_17">StarWarsFilmsTable</code> is an <code class="code" id="-60e45b_18">IntIdTable</code>, the <code class="code" id="-60e45b_19">StarWarsFilmsEntity</code> class extends from <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-int-entity/index.html" id="-60e45b_20" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_21">IntEntity</code></a>, which indicates that the <code class="code" id="-60e45b_22">id</code> and primary key of <code class="code" id="-60e45b_23">StarWarsFilmsTable</code> is of type <code class="code" id="-60e45b_24">Int</code>.</p><p id="-60e45b_25">The following entity types are supported:</p><dl id="-60e45b_26" data-style="title-left" data-title-width="medium"><dt id="IntEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-int-entity/index.html" id="-60e45b_28" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_29">IntEntity</code></a></dt><dd><p id="-60e45b_30">Base class for an entity instance identified by an id comprised of a wrapped <code class="code" id="-60e45b_31">Int</code> value.</p></dd><dt id="LongEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-long-entity/index.html" id="-60e45b_33" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_34">LongEntity</code></a></dt><dd><p id="-60e45b_35">Base class for an entity instance identified by an id comprised of a wrapped <code class="code" id="-60e45b_36">Long</code> value.</p></dd><dt id="UIntEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-u-int-entity/index.html" id="-60e45b_38" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_39">UIntEntity</code></a></dt><dd><p id="-60e45b_40">Base class for an entity instance identified by an id comprised of a wrapped <code class="code" id="-60e45b_41">UInt</code> value.</p></dd><dt id="ULongEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-u-long-entity/index.html" id="-60e45b_43" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_44">ULongEntity</code></a></dt><dd><p id="-60e45b_45">Base class for an entity instance identified by an id comprised of a wrapped <code class="code" id="-60e45b_46">ULong</code> value.</p></dd><dt id="UUIDEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-u-u-i-d-entity/index.html" id="-60e45b_48" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_49">UUIDEntity</code></a></dt><dd><p id="-60e45b_50">Base class for an entity instance identified by an id comprised of a wrapped <code class="code" id="-60e45b_51">UUID</code> value.</p></dd><dt id="CompositeEntity" data-expandable="false"><a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-composite-entity/index.html" id="-60e45b_53" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_54">CompositeEntity</code></a></dt><dd><p id="-60e45b_55">Base class for an entity instance identified by an id comprised of multiple wrapped values.</p></dd></dl></section><section class="chapter"><h3 id="EntityClass" data-toc="EntityClass">EntityClass</h3><p id="-60e45b_56">The <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-entity-class/index.html" id="-60e45b_57" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_58">EntityClass</code></a> in the <code class="code" id="-60e45b_59">companion object</code> block is responsible for managing <code class="code" id="-60e45b_60">Entity</code> instances, such as creating, querying, and deleting records. It also maintains the relationship between the entity class (<code class="code" id="-60e45b_61">StarWarsFilmEntity</code> in this example) and the database table (<code class="code" id="-60e45b_62">StarWarsFilmsTable</code>).</p><p id="-60e45b_63">Each entity type is supported by a corresponding <code class="code" id="-60e45b_64">EntityClass</code>, which accepts the following parameters:</p><dl id="-60e45b_65" data-style="title-left" data-title-width="medium"><dt id="table-param" data-expandable="false">table</dt><dd><p>The <code class="code" id="-60e45b_66">IdTable</code> containing rows mapped to entities managed by this class.</p></dd><dt id="entityType-param" data-expandable="false">entityType</dt><dd><p>(Optional) The expected type of the <code class="code" id="-60e45b_67">Entity</code> class. This can be omitted if it is the class of the type argument provided to this <code class="code" id="-60e45b_68">EntityClass</code> instance.</p></dd><dt id="entityCtor-param" data-expandable="false">entityCtor</dt><dd><p>(Optional) The function that instantiates an <code class="code" id="-60e45b_69">Entity</code> using the provided <code class="code" id="-60e45b_70">EntityID</code>. If not provided, reflection is used to determine the primary constructor on the first access (which may affect performance).</p></dd></dl><p id="-60e45b_71">In the example above, <code class="code" id="-60e45b_72">IntEntityClass</code> is specified in the companion object:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">    companion object : IntEntityClass&lt;StarWarsFilmEntity&gt;(StarWarsFilmsTable)</div><p id="-60e45b_74">This setup enables you to use functions provided by <code class="code" id="-60e45b_75">IntEntityClass</code> to manage instances of <code class="code" id="-60e45b_76">StarWarsFilmEntity</code> effectively.</p></section><section class="chapter"><h3 id="properties" data-toc="properties">Properties</h3><p id="-60e45b_77">Each column in the table is represented as a property in the entity class, where the <code class="code" id="-60e45b_78">by</code> keyword ensures the data is fetched or updated from the corresponding column when accessed.</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">
    var sequelId by StarWarsFilmsTable.sequelId
    var name by StarWarsFilmsTable.name
    var director by StarWarsFilmsTable.director</div></section><p id="-60e45b_80">Once the entity class is defined, instances of this class allow you to manipulate individual records from the corresponding table. This could involve <a href="dao-crud-operations.html#create" id="-60e45b_81" data-tooltip="To create a new table row, use the new function on the entity class:">creating a new record</a>, <a href="dao-crud-operations.html#read" id="-60e45b_82" data-tooltip="To read a value from a property, simply access it as you would with any property in a Kotlin class:">retrieving a row based on its primary key</a>, <a href="dao-crud-operations.html#update" id="-60e45b_83" data-tooltip="You can update the value of a property just as you would with any property in a Kotlin class:">updating values</a>, or <a href="dao-crud-operations.html#delete" id="-60e45b_84" data-tooltip="To delete a record, use the delete() function:">deleting records</a>.</p></section><section class="chapter"><h2 id="immutable-entities" data-toc="immutable-entities">Immutable entities</h2><p id="-60e45b_85">For defining entities that are immutable, Exposed provides the additional <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-immutable-entity-class/index.html" id="-60e45b_86" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_87">ImmutableEntityClass</code></a> and <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-immutable-cached-entity-class/index.html" id="-60e45b_88" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_89">ImmutableCachedEntityClass</code></a>.</p><p id="-60e45b_90">The <code class="code" id="-60e45b_91">ImmutableCachedEntityClass</code> uses an internal cache to store entity loading states by the associated database. This ensures that entity updates are synchronized with this class as the lock object.</p><p id="-60e45b_92">To create an immutable entity, use either <code class="code" id="-60e45b_93">ImmutableEntityClass</code> or <code class="code" id="-60e45b_94">ImmutableCachedEntityClass</code> as a companion object in your entity class. For example, here&rsquo;s how to define a <code class="code" id="-60e45b_95">CityEntity</code> class:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">package org.example.entities

import org.example.tables.CitiesTable
import org.jetbrains.exposed.dao.ImmutableEntityClass
import org.jetbrains.exposed.dao.IntEntity
import org.jetbrains.exposed.dao.id.EntityID

class CityEntity(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    val name by CitiesTable.name

    companion object : ImmutableEntityClass&lt;Int, CityEntity&gt;(CitiesTable)
}
</div><ul class="list _bullet" id="-60e45b_97"><li class="list__item" id="-60e45b_98"><p>Properties are defined using <code class="code" id="-60e45b_99">val</code> instead of <code class="code" id="-60e45b_100">var</code>. This enforces immutability, as <code class="code" id="-60e45b_101">val</code> properties cannot be reassigned after initial assignment.</p></li><li class="list__item" id="-60e45b_102"><p>The primary function of the entity class in this context is to query data from the associated table, not to modify it. Therefore, inserts can only be performed using the DSL <a href="dsl-crud-operations.html#insert" id="-60e45b_103" data-tooltip="To create a new table row, use the insert query. If the same row already exists in the table, it throws an exception."><code class="code" id="-60e45b_104">insert()</code></a> method and updates can be done either through the DSL <a href="dsl-crud-operations.html#update" id="-60e45b_105" data-tooltip="To update a record, use the update() function. By default, it returns the number of updated rows."><code class="code" id="-60e45b_106">update()</code></a> or the <a href="https://jetbrains.github.io/Exposed/api/exposed-dao/org.jetbrains.exposed.dao/-immutable-entity-class/force-update-entity.html" id="-60e45b_107" data-external="true" rel="noopener noreferrer"><code class="code" id="-60e45b_108">ImmutableEntityClass.forceUpdateEntity()</code></a> methods.</p></li></ul></section><section class="chapter"><h2 id="class-method-overrides" data-toc="class-method-overrides">Class method overrides</h2><p id="-60e45b_109">You can use override methods in both the <code class="code" id="-60e45b_110">Entity</code> class and the <code class="code" id="-60e45b_111">EntityClass</code> companion object to extend functionality or manage entity behavior.</p><p id="-60e45b_112">For example, here&rsquo;s how to override the <code class="code" id="-60e45b_113">delete()</code> method in a <code class="code" id="-60e45b_114">User</code> entity:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">package org.example.entities

import org.example.tables.UsersTable
import org.jetbrains.exposed.dao.IntEntity
import org.jetbrains.exposed.dao.IntEntityClass
import org.jetbrains.exposed.dao.id.EntityID

class UserEntityWithOverride(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    companion object : IntEntityClass&lt;UserEntityWithOverride&gt;(UsersTable)

    var name by UsersTable.name
    var city by CityEntity referencedOn UsersTable.cityId

    override fun delete() {
        println(&quot;Deleting user $name with ID: $id&quot;)
        super.delete()
    }
}
</div><p id="-60e45b_116">In this example, a custom message is printed before the <code class="code" id="-60e45b_117">delete()</code> function of the superclass (<code class="code" id="-60e45b_118">IntEntity</code>) completes the deletion.</p></section><section class="chapter"><h2 id="field-transformations" data-toc="field-transformations">Field transformations</h2><p id="-60e45b_119">As databases typically store only basic types, such as integers and strings, it's not always convenient to keep the same simplicity on Data Access Object (DAO) level.</p><p id="-60e45b_120">For example, you might need to parse JSON from a <code class="code" id="-60e45b_121">VARCHAR</code> column, or retrieve values from a cache based on data from the database. In such cases, the preferred approach is to use column transformations.</p><section class="chapter"><h3 id="defining-unsigned-int-field" data-toc="defining-unsigned-int-field">Example: Defining an Unsigned Integer field</h3><p id="-60e45b_122">Suppose that you want to define an unsigned integer field on an entity, but Exposed doesn't have such column type yet. You can achieve this by using the following implementation:</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">package org.example.entities

import org.jetbrains.exposed.dao.IntEntity
import org.jetbrains.exposed.dao.IntEntityClass
import org.jetbrains.exposed.dao.id.EntityID
import org.jetbrains.exposed.dao.id.IntIdTable

object TableWithUnsignedInteger : IntIdTable() {
    val uint = integer(&quot;uint&quot;)
}

class EntityWithUInt(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    var uint: UInt by TableWithUnsignedInteger.uint.transform({ it.toInt() }, { it.toUInt() })

    companion object : IntEntityClass&lt;EntityWithUInt&gt;(TableWithUnsignedInteger)
}
</div><p id="-60e45b_124">The <code class="code" id="-60e45b_125">transform</code> function accept two lambdas that convert values to and from the original column type. In this case, you make sure to store only <code class="code" id="-60e45b_126">UInt</code> instances in the <code class="code" id="-60e45b_127">uint</code> field.</p><p id="-60e45b_128">Although it is still possible to insert or update values with negative integers via DAO, this approach assures a cleaner business logic.</p></section><section class="chapter"><h3 id="memoized-transformations" data-toc="memoized-transformations">Memoized transformations</h3><p id="-60e45b_129">If your transformation function involves complex operations that impact performance, you can use <code class="code" id="-60e45b_130">memoizedTransform</code> to cache the result of the transformation.</p><div class="code-block" data-lang="kotlin" data-disable-link-processing="true">package org.example.entities

import org.jetbrains.exposed.dao.IntEntity
import org.jetbrains.exposed.dao.IntEntityClass
import org.jetbrains.exposed.dao.id.EntityID
import org.jetbrains.exposed.dao.id.IntIdTable
import java.util.Base64

object TableWithText : IntIdTable() {
    val text = varchar(&quot;text&quot;, length = 2048)
}

class EntityWithBase64(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    var base64: String by TableWithText.text
        .memoizedTransform(
            wrap = { Base64.getEncoder().encodeToString(it.toByteArray()) },
            unwrap = { Base64.getDecoder().decode(it).toString() }
        )

    companion object :
        IntEntityClass&lt;EntityWithBase64&gt;(TableWithText)
}
</div><p id="-60e45b_132">With memorized transformation, the value is unwrapped only once and then cached for future reads. This cache remains valid for the lifetime of the entity. If the transaction's entity cache is cleared or the entity is reloaded in a new transaction (creating a new cache without the existing value), the value will be wrapped again. However, if the original entity is kept alive outside of the transaction, the cached value persists to avoid re-wrapping.</p></section></section><div class="last-modified">Last modified: 05 December 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="dao-table-types.html" class="navigation-links__prev">Table types</a><a href="dao-crud-operations.html" class="navigation-links__next">CRUD operations</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.js"></script></body></html>